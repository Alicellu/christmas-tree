<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <title>3D Christmas Tree</title>
    <!-- 手書き風フォントの読み込み -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            /* スクロール防止 */
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .main-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 95vmin;
            /* 画面幅いっぱいまで使う */
            max-width: 600px;
            position: relative;
        }

        .scene {
            perspective: 90vmin;
            position: relative;
            width: 100%;
            height: 85vmin;
            /* ツリーエリアを拡大 */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }

        tree {
            position: relative;
            height: 70vmin;
            /* ツリー高さを拡大 */
            width: 35vmin;
            /* ツリー幅を拡大 */
            transform-style: preserve-3d;
            display: block;
            animation: spin 2.5s infinite linear;
        }

        @keyframes spin {
            from {
                transform: rotateX(18deg) rotateY(0deg);
            }

            to {
                transform: rotateX(18deg) rotateY(360deg);
            }
        }

        /* 星 */
        .star {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translate(-50%, -60%);
            width: 10vmin;
            /* トップスター拡大 */
            height: 10vmin;
            display: flex;
            justify-content: center;
            align-items: center;
            filter:
                drop-shadow(0 0 1px #ffe66d) drop-shadow(0 0 4px #ffe66d);
        }

        .star__svg {
            width: 100%;
            height: 100%;
        }

        /* ライト */
        .tree__light {
            position: absolute;
            left: 50%;
            transform-style: preserve-3d;
            height: 1.2vmin;
            /* ライト拡大 */
            width: 1.2vmin;
            border-radius: 50%;
            background: radial-gradient(circle, #ffffff, #ff1744);
            box-shadow:
                0 0 3px #ff1744,
                0 0 6px #ff1744;
            top: calc(var(--y, 0) * 1%);
            transform:
                translate(-50%, -50%) rotateY(calc(var(--rotate, 0) * 1deg)) translateZ(calc(var(--radius, 0) * 1vmin));
            animation: blink 2s infinite ease-in-out;
            animation-delay: var(--delay, 0s);
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        /* 手書き風文字のアニメーションコンテナ */
        .message-container {
            position: relative;
            width: 100%;
            height: 20vmin;
            /* 文字エリア拡大 */
            padding: 0;
            margin-top: -10vmin;
            /* 少しツリーに重ねるくらい近づける */
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        /* SVGテキストの設定 */
        .handwriting-svg {
            width: 100%;
            height: 100%;
            overflow: visible;
            /* ここ重要：はみ出しても表示 */
        }

        .handwriting-text {
            font-family: 'Great Vibes', cursive;
            font-size: 60px;
            /* フォントサイズも少し大きく */
            fill: url(#goldGradient);
            fill-opacity: 0;
            stroke: #e6c200;
            stroke-width: 1.5px;
            stroke-dasharray: 3000;
            stroke-dashoffset: 3000;
            animation:
                draw 4s ease-out forwards,
                fill-in 2s ease-in-out 3s forwards;
            filter: drop-shadow(0 0 2px rgba(255, 215, 0, 0.8));
        }

        /* 線を描く */
        @keyframes draw {
            to {
                stroke-dashoffset: 0;
            }
        }

        /* 中身を不透明にする（徐々に表示） */
        @keyframes fill-in {
            to {
                fill-opacity: 1;
                stroke-width: 0;
            }
        }

        /* 小さな星 */
        .tiny-star {
            position: absolute;
            width: 1vmin;
            /* 背景星拡大 */
            height: 1vmin;
            border-radius: 50%;
            background: #ffffff;
            box-shadow:
                0 0 2px rgba(255, 255, 255, 0.9),
                0 0 4px rgba(255, 255, 255, 0.8);
            opacity: 0.7;
            animation: tinyBlink 3s infinite ease-in-out;
        }

        /* 4角の星 */
        .four-point-star {
            position: absolute;
            background: white;
            clip-path: polygon(50% 0%, 65% 40%, 100% 50%, 65% 60%, 50% 100%, 35% 60%, 0% 50%, 35% 40%);
            opacity: 0.8;
            animation: tinyBlink 3s infinite ease-in-out;
        }

        @keyframes tinyBlink {

            0%,
            100% {
                opacity: 0.2;
                transform: scale(0.8);
            }

            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }
    </style>

<body>
    <div class="main-wrapper">
        <div class="scene">
            <tree id="tree">
                <!-- 星 -->
                <div class="star">
                    <svg class="star__svg" viewBox="0 0 100 100">
                        <polygon points="50,5 61,35 95,38 68,59 76,91 50,73 24,91 32,59 5,38 39,35" fill="none"
                            stroke="#ffe66d" stroke-width="5" stroke-linejoin="round" />
                    </svg>
                </div>
            </tree>
        </div>

        <!-- 手書き風文字 (SVG) -->
        <div class="message-container">
            <!-- viewBoxを広げて文字切れを防ぐ -->
            <svg class="handwriting-svg" viewBox="0 0 550 120">
                <!-- 金色のグラデーション定義 -->
                <defs>
                    <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" stop-color="#BF953F" />
                        <stop offset="25%" stop-color="#FCF6BA" />
                        <stop offset="50%" stop-color="#B38728" />
                        <stop offset="75%" stop-color="#FBF5B7" />
                        <stop offset="100%" stop-color="#AA771C" />
                    </linearGradient>
                </defs>

                <!-- テキスト本体：中心配置 -->
                <text x="50%" y="65%" text-anchor="middle" class="handwriting-text">
                    2025 Merry Christmas
                </text>
            </svg>
        </div>
    </div>

    <script>
        const tree = document.getElementById("tree");

        // ライト設定
        const LIGHT_COUNT = 80;
        const TURNS = 3;
        const MIN_RADIUS = 1.2;
        const MAX_RADIUS = 8;

        for (let i = 0; i < LIGHT_COUNT; i++) {
            const light = document.createElement("div");
            light.className = "tree__light";

            const t = i / (LIGHT_COUNT - 1);

            const y = 6 + t * 86;
            const rotate = t * 360 * TURNS;
            const radius = MIN_RADIUS * (1 - t) + MAX_RADIUS * t;
            const delay = Math.random() * 2;

            light.style.setProperty("--y", y);
            light.style.setProperty("--rotate", rotate);
            light.style.setProperty("--radius", radius);
            light.style.setProperty("--delay", `${delay}s`);

            // 白い光の設定
            if (Math.random() > 0.5) {
                light.style.background = "radial-gradient(circle, #ffffff, #ffffff)";
                light.style.boxShadow =
                    "0 0 3px #ffffff, 0 0 6px #ffffff";
            }

            tree.appendChild(light);
        }

        // 背景の星
        /* .sceneに追加 */
        const scene = document.querySelector(".scene");
        const STAR_COUNT = 40;

        for (let i = 0; i < STAR_COUNT; i++) {
            const s = document.createElement("div");

            const isFourPoint = Math.random() > 0.4;

            if (isFourPoint) {
                s.className = "four-point-star";
                const hue = Math.floor(Math.random() * 360);
                s.style.background = `hsl(${hue}, 80%, 70%)`;
                const size = 0.8 + Math.random() * 1.2;
                s.style.width = `${size}vmin`;
                s.style.height = `${size}vmin`;
            } else {
                s.className = "tiny-star";
            }

            // 横幅を文字幅に合わせる (大体 0% 〜 100% の範囲に収める - scene幅が狭くなったため全体使ってOK)
            const x = Math.random() * 100;
            const y = Math.random() * 100;

            s.style.left = `${x}%`;
            s.style.top = `${y}%`;
            s.style.animationDelay = `${Math.random() * 3}s`;

            scene.appendChild(s);
        }
    </script>
</body>

</html>