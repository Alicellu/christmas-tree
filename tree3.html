<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <title>3D Christmas Tree</title>
    <!-- 手書き風フォントの読み込み -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            /* スクロール防止 */
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            position: relative;
            /* 星の基準 */
        }

        .main-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /* 画面いっぱいまで拡大 */
            width: 100vmin;
            height: 100vmin;
            position: relative;
            z-index: 10;
            /* 星より手前 */
        }

        .scene {
            perspective: 90vmin;
            position: relative;
            width: 100%;
            height: 100%;
            /* 親に合わせて最大化 */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        tree {
            position: relative;
            /* ツリーサイズさらに拡大 */
            height: 80vmin;
            width: 45vmin;
            transform-style: preserve-3d;
            display: block;
            animation: spin 2.5s infinite linear;
            margin-top: -5vmin;
            /* 少し調整 */
            will-change: transform;
            /* パフォーマンス最適化 */
        }

        @keyframes spin {
            from {
                transform: rotateX(18deg) rotateY(0deg);
            }

            to {
                transform: rotateX(18deg) rotateY(360deg);
            }
        }

        /* 星 */
        .star {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translate(-50%, -60%);
            width: 12vmin;
            /* さらに拡大 */
            height: 12vmin;
            display: flex;
            justify-content: center;
            align-items: center;
            /* ドロップシャドウも金色系に */
            filter: drop-shadow(0 0 1px #e6c200) drop-shadow(0 0 4px #e6c200);
        }

        .star__svg {
            width: 100%;
            height: 100%;
        }

        /* ライト */
        .tree__light {
            position: absolute;
            left: 50%;
            transform-style: preserve-3d;
            height: 1.4vmin;
            /* さらに拡大 */
            width: 1.4vmin;
            border-radius: 50%;
            background: radial-gradient(circle, #ffffff, #ff1744);
            box-shadow:
                0 0 2px #ff1744,
                0 0 4px #ff1744;
            /* 負荷軽減のため縮小 */
            top: calc(var(--y, 0) * 1%);
            transform:
                translate(-50%, -50%) rotateY(calc(var(--rotate, 0) * 1deg)) translateZ(calc(var(--radius, 0) * 1vmin));
            animation: blink 2s infinite ease-in-out;
            animation-delay: var(--delay, 0s);
            will-change: transform, opacity;
            /* パフォーマンス最適化 */
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        /* 手書き風文字のアニメーションコンテナ */
        /* body直下に配置し、画面全幅を使う */
        .message-container {
            position: absolute;
            bottom: 8vmin;
            left: 0;
            width: 100%;
            /* 画面幅いっぱい */
            height: 25vmin;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            /* 下揃え */
            z-index: 1000;
        }

        /* SVGテキストの設定 */
        .handwriting-svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .handwriting-text {
            font-family: 'Great Vibes', cursive;
            font-size: 60px;
            fill: url(#goldGradient);
            fill-opacity: 0;
            stroke: #e6c200;
            stroke-width: 1.5px;
            stroke-dasharray: 3000;
            stroke-dashoffset: 3000;
            animation:
                draw 4s ease-out forwards,
                fill-in 2s ease-in-out 3s forwards;
            filter: drop-shadow(0 0 2px rgba(255, 215, 0, 0.8));
        }

        /* 線を描く */
        @keyframes draw {
            to {
                stroke-dashoffset: 0;
            }
        }

        /* 中身を不透明にする（徐々に表示） */
        @keyframes fill-in {
            to {
                fill-opacity: 1;
                stroke-width: 0;
            }
        }

        /* 背景の星（ランダム配置用） */
        .bg-star {
            position: absolute;
            border-radius: 50%;
            background: #ffffff;
            box-shadow:
                0 0 2px rgba(255, 255, 255, 0.9),
                0 0 4px rgba(255, 255, 255, 0.8);
            opacity: 0.7;
            animation: tinyBlink 3s infinite ease-in-out;
            z-index: 0;
            /* 最背面 */
        }

        .four-point-star-bg {
            position: absolute;
            background: white;
            clip-path: polygon(50% 0%, 65% 40%, 100% 50%, 65% 60%, 50% 100%, 35% 60%, 0% 50%, 35% 40%);
            opacity: 0.8;
            animation: tinyBlink 3s infinite ease-in-out;
            z-index: 0;
        }

        @keyframes tinyBlink {

            0%,
            100% {
                opacity: 0.2;
                transform: scale(0.6);
            }

            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        /* 水滴ライト */
        .rain-drop {
            position: absolute;
            top: -15vh;
            /* 画面外からスタート */
            width: 2px;
            height: 15vh;
            background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.9));
            animation: fall linear infinite;
            pointer-events: none;
            z-index: 20;
            /* ツリーより手前、文字より奥 */
            opacity: 0;
            will-change: transform;
            /* パフォーマンス最適化 */
        }

        @keyframes fall {
            0% {
                transform: translateY(0);
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            90% {
                opacity: 1;
            }

            100% {
                transform: translateY(120vh);
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <div class="main-wrapper">
        <div class="scene">
            <tree id="tree">
                <!-- 星: グラデーション塗りつぶし -->
                <div class="star">
                    <svg class="star__svg" viewBox="0 0 100 100">
                        <defs>
                            <linearGradient id="starGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#BF953F" />
                                <stop offset="25%" stop-color="#FCF6BA" />
                                <stop offset="50%" stop-color="#B38728" />
                                <stop offset="75%" stop-color="#FBF5B7" />
                                <stop offset="100%" stop-color="#AA771C" />
                            </linearGradient>
                        </defs>
                        <polygon points="50,5 61,35 95,38 68,59 76,91 50,73 24,91 32,59 5,38 39,35"
                            fill="url(#starGradient)" stroke="none" />
                    </svg>
                </div>
            </tree>
        </div>
    </div>

    <!-- 手書き風文字 (SVG) - main-wrapperの外に出して全幅確保 -->
    <div class="message-container">
        <!-- viewBox広め、文字は中央配置（全幅なので中央でOK） -->
        <svg class="handwriting-svg" viewBox="0 0 600 100">
            <!-- 金色のグラデーション定義 -->
            <defs>
                <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#BF953F" />
                    <stop offset="25%" stop-color="#FCF6BA" />
                    <stop offset="50%" stop-color="#B38728" />
                    <stop offset="75%" stop-color="#FBF5B7" />
                    <stop offset="100%" stop-color="#AA771C" />
                </linearGradient>
            </defs>

            <!-- テキスト本体 -->
            <text x="50%" y="70%" text-anchor="middle" class="handwriting-text">
                2025 Merry Christmas
            </text>
        </svg>
    </div>

    <script>
        const tree = document.getElementById("tree");

        // ライト設定
        const LIGHT_COUNT = 80;
        const TURNS = 3;
        const MIN_RADIUS = 1.2;
        const MAX_RADIUS = 8;

        for (let i = 0; i < LIGHT_COUNT; i++) {
            const light = document.createElement("div");
            light.className = "tree__light";

            const t = i / (LIGHT_COUNT - 1);

            const y = 6 + t * 86;
            const rotate = t * 360 * TURNS;
            const radius = MIN_RADIUS * (1 - t) + MAX_RADIUS * t;
            const delay = Math.random() * 2;

            light.style.setProperty("--y", y);
            light.style.setProperty("--rotate", rotate);
            light.style.setProperty("--radius", radius);
            light.style.setProperty("--delay", `${delay}s`);

            // 白い光の設定
            if (Math.random() > 0.5) {
                light.style.background = "radial-gradient(circle, #ffffff, #ffffff)";
                light.style.boxShadow =
                    "0 0 3px #ffffff, 0 0 6px #ffffff";
            }

            tree.appendChild(light);
        }

        // 背景の星（全画面ランダム）
        const STAR_COUNT = 150;

        for (let i = 0; i < STAR_COUNT; i++) {
            const s = document.createElement("div");
            const isFourPoint = Math.random() > 0.4;
            let size;

            if (isFourPoint) {
                s.className = "four-point-star-bg";
                const hue = Math.floor(Math.random() * 360);
                s.style.background = `hsl(${hue}, 80%, 70%)`;
                // サイズランダム（大・小混ぜる）
                size = 0.5 + Math.random() * 2.5;
            } else {
                s.className = "bg-star";
                size = 0.3 + Math.random() * 1.5;
            }

            s.style.width = `${size}vmin`;
            s.style.height = `${size}vmin`;

            // 画面全体に配置 (0-100%)
            const x = Math.random() * 100;
            const y = Math.random() * 100;

            s.style.left = `${x}%`;
            s.style.top = `${y}%`;
            s.style.animationDelay = `${Math.random() * 3}s`;

            // bodyに追加
            document.body.appendChild(s);
        }

        // 水滴ライト (Rain Lights)
        const RAIN_COUNT = 40;

        for (let i = 0; i < RAIN_COUNT; i++) {
            const drop = document.createElement("div");
            drop.className = "rain-drop";

            // X座標はランダム
            drop.style.left = Math.random() * 100 + "%";

            // アニメーション時間と遅延をランダムにして自然な不規則さを出す
            const duration = 2 + Math.random() * 3; // 2〜5秒
            const delay = Math.random() * 5; // 0〜5秒

            drop.style.animationDuration = `${duration}s`;
            drop.style.animationDelay = `${delay}s`;

            // 長さも少しランダムに
            const height = 10 + Math.random() * 10; // 10vh〜20vh
            drop.style.height = `${height}vh`;

            document.body.appendChild(drop);
        }
    </script>
</body>

</html>
